<?xml version="1.0" encoding="UTF-8"?>
<sqlmaps>
	<!-- 借款人 -->
	<sql name="queryJksqList" common="true">
		<sqlString><![CDATA[
			select 
				a.ID,a.JKRXM,a.JK_LOAN_QUOTA,a.JK_CYCLE,
				to_char(a.JK_LOAN_DATE,'yyyy-mm-dd') as JK_LOAN_DATE,a.JK_USE,
				a.TOGETHER_PERSON istogether,
				
				(select k.together_name from xh_jksq_together k 
					where k.id =(
						select max(t.id) from xh_jksq_together t 
						where t.xhjksq_id=a.id 
				) ) as TOGETHER_PERSON,
				
				a.BANK_OPEN,a.BANK_USERNAME,a.BANK_NUM,
				a.JK_TYPE,
				(select t.description from base_attr t where t.value=a.JK_TYPE and t.type_id='3') JK_TYPE_INFO,
				a.EXAM_STATE,a.EXAM_END_STATE,
				a.CREATE_BY,	to_char(a.create_time,'yyyy-mm-dd HH24:MI:SS') as createTime,a.LAST_MODIFY_BY,
				to_char(a.LAST_MODIFY_TIME,'yyyy-mm-dd HH24:MI:SS') as lastModifyTime,
				a.ORGANI_ID,a.ANNUAL_INCOME,a.BIRTHDAY,a.COMPANY,a.COMPANY_ADRESS,
				a.COMPANY_NATURE,a.COMPANY_PHONE,a.DATA,a.EMAIL,
				a.ENGLISH_NAME,a.GENDERS,a.HJADRESS,a.HOME_ADDRESS,a.HOME_PHONE,
				a.INCOME_ILLUSTRATION,a.LIVE_MESSAGE,a.LIVE_STATE,
				a.MARITAL_STATUS,a.POCERTIFICATES,a.QQHM,a.SPOUSE_ADRESS,
				a.SPOUSE_ANNUAL_INCOME,a.SPOUSE_BIRTHDAY,a.SPOUSE_COMPANY,
				a.SPOUSE_COMPANY_ADRESS,a.SPOUSE_COMPANY_PHONE,a.SPOUSE_DEP_FUNCTION,
				a.SPOUSE_GENDERS,a.SPOUSE_HOME_PHONE,a.SPOUSE_NAME,a.SPOUSE_POCERTIFICATES,
				a.SPOUSE_TELEPHONE,a.SPOUSE_WORKINGLIFE,a.SPOUSE_ZJHM,a.TELEPHONE,
				a.YWZN,a.ZJHM,a.TEMPLET_ID,
				a.STATE,a.BACKUP01,
				substr(a.BACKUP02,0,19) as BACKUP02,
				a.BACKUP03,a.BACKUP04,
				a.BACKUP05,a.BACKUP06,a.BACKUP07,a.BACKUP08,a.BACKUP09,
				(select KEY_NAME from BASE_ATTR t, BASE_ATTR_TYPE bat 
				    where bat.id = t.type_id and bat.coding = 'JKSQ_STATE' and t.VALUE=a.STATE ) stateInfo,
				a.TXDZ,a.LOAN_CODE,
				a.XYDKZX_ID,a.FKJE,a.APP_STATE,
				(select ID from XH_JKHT t where t.JKSQ_ID=a.ID) XHJKHT_ID,
				(
			        select x.RGANI_NAME from BASE_ZZJG x where x.id =( select y.PARENT_ID from BASE_ZZJG y
			         where y.id =(select ORGANI_ID from BASE_EMPLOYEE z
			       where z.id = (select t.employee_crm from XH_XYDKZX t where t.ID=a.XYDKZX_ID)))
			     ) as yyb,
			     (
			        select x.id from BASE_ZZJG x where x.id =( select y.PARENT_ID from BASE_ZZJG y
			         where y.id =(select ORGANI_ID from BASE_EMPLOYEE z
			       where z.id = (select t.employee_crm from XH_XYDKZX t where t.ID=a.XYDKZX_ID)))
			     ) as yybid,
				(select t.name from base_employee t,xh_xydkzx xy where t.id=xy.employee_cca and xy.id=a.xydkzx_id) saleName,
				(select t.name from base_employee t,xh_xydkzx xy where t.id=xy.employee_crm and xy.id=a.xydkzx_id) teamName,
				a.SUB_STATE,
				(select t.KHMC from XH_XYDKZX t where t.ID=a.XYDKZX_ID) KHMC,
				a.province,
				 (
				 select name from base_city z
				 where z.id=a.province
				 ) as proname,
				 a.city,
				 (
				 select name from base_city z
				 where z.id=a.city
				 ) as cityname,
				 a.area,
				 (
				 select name from base_city z
				 where z.id=a.area
				 ) as areaname
				 				 
				
			 from XH_JKSQ a
			 $tablesql
			      where 1=1
			 $unionsql
			 $sql
			]]></sqlString>
	</sql>
	
	<!-- 查询 总数 -->
	<sql name="cnt_queryJksqList" common="false">
		<sqlString>
			<![CDATA[
			SELECT COUNT(*) RecordCount FROM (
			$ibpm_queryJksqList
			) a
		]]>
		</sqlString>
	</sql>
	<!-- 查询 列表分页 -->
	<sql name="page_queryJksqList" common="false">
		<sqlString>
			<![CDATA[
			$ibpm_queryPageBefore
			$ibpm_queryJksqList
			$ibpm_queryPageAfter
			]]>
		</sqlString>
	</sql>
	
	<!-- 借款申请到期列表 -->
	<sql name="queryJksqExpireList" common="true">
		<sqlString><![CDATA[
			select * from (
		      select 
		        h.qshkrq,
		        h.hkqs,
		        h.fkje,
            	h.htje,
		        getdd(to_char(add_months(to_date(h.qshkrq,'yyyy-mm-dd'),h.hkqs-1),'yyyy-mm-dd')) as dqrq,
		        h.hkqs - (to_char(months_between(to_date(to_char(sysdate,'yyyy-mm'),'yyyy-mm'),to_date(to_char(to_date(h.qshkrq,'yyyy-mm-dd'),'yyyy-mm'),'yyyy-mm')))+1) as isExpire ,
		        a.ID,a.JKRXM,a.JK_LOAN_QUOTA,a.JK_CYCLE,
		        to_char(a.JK_LOAN_DATE,'yyyy-mm-dd') as JK_LOAN_DATE,a.JK_USE,
		        a.TOGETHER_PERSON istogether,
		        
		        (select k.together_name from xh_jksq_together k 
		          where k.id =(
		            select max(t.id) from xh_jksq_together t 
		            where t.xhjksq_id=a.id 
		        ) ) as TOGETHER_PERSON,
		        
		        a.BANK_OPEN,a.BANK_USERNAME,a.BANK_NUM,
		        a.JK_TYPE,
		        (select t.description from base_attr t where t.value=a.JK_TYPE and t.type_id='3') JK_TYPE_INFO,
		        a.EXAM_STATE,a.EXAM_END_STATE,
		        a.CREATE_BY,  to_char(a.create_time,'yyyy-mm-dd HH24:MI:SS') as createTime,a.LAST_MODIFY_BY,
		        to_char(a.LAST_MODIFY_TIME,'yyyy-mm-dd HH24:MI:SS') as lastModifyTime,
		        a.ORGANI_ID,a.ANNUAL_INCOME,a.BIRTHDAY,a.COMPANY,a.COMPANY_ADRESS,
		        a.COMPANY_NATURE,a.COMPANY_PHONE,a.DATA,a.EMAIL,
		        a.ENGLISH_NAME,a.GENDERS,a.HJADRESS,a.HOME_ADDRESS,a.HOME_PHONE,
		        a.INCOME_ILLUSTRATION,a.LIVE_MESSAGE,a.LIVE_STATE,
		        a.MARITAL_STATUS,a.POCERTIFICATES,a.QQHM,a.SPOUSE_ADRESS,
		        a.SPOUSE_ANNUAL_INCOME,a.SPOUSE_BIRTHDAY,a.SPOUSE_COMPANY,
		        a.SPOUSE_COMPANY_ADRESS,a.SPOUSE_COMPANY_PHONE,a.SPOUSE_DEP_FUNCTION,
		        a.SPOUSE_GENDERS,a.SPOUSE_HOME_PHONE,a.SPOUSE_NAME,a.SPOUSE_POCERTIFICATES,
		        a.SPOUSE_TELEPHONE,a.SPOUSE_WORKINGLIFE,a.SPOUSE_ZJHM,a.TELEPHONE,
		        a.YWZN,a.ZJHM,a.TEMPLET_ID,
		        a.STATE,a.BACKUP01,
		        substr(a.BACKUP02,0,19) as BACKUP02,
		        a.BACKUP03,a.BACKUP04,
		        a.BACKUP05,a.BACKUP06,a.BACKUP07,a.BACKUP08,a.BACKUP09,
		        (select KEY_NAME from BASE_ATTR t, BASE_ATTR_TYPE bat 
		            where bat.id = t.type_id and bat.coding = 'JKSQ_STATE' and t.VALUE=a.STATE ) stateInfo,
		        a.TXDZ,a.LOAN_CODE,
		        a.XYDKZX_ID,a.APP_STATE,
		        (select ID from XH_JKHT t where t.JKSQ_ID=a.ID) XHJKHT_ID,
		        (
		              select x.RGANI_NAME from BASE_ZZJG x where x.id =( select y.PARENT_ID from BASE_ZZJG y
		               where y.id =(select ORGANI_ID from BASE_EMPLOYEE z
		             where z.id = (select t.employee_crm from XH_XYDKZX t where t.ID=a.XYDKZX_ID)))
		           ) as yyb,
		           (
		              select x.id from BASE_ZZJG x where x.id =( select y.PARENT_ID from BASE_ZZJG y
		               where y.id =(select ORGANI_ID from BASE_EMPLOYEE z
		             where z.id = (select t.employee_crm from XH_XYDKZX t where t.ID=a.XYDKZX_ID)))
		           ) as yybid,
		        (select t.name from base_employee t,xh_xydkzx xy where t.id=xy.employee_cca and xy.id=a.xydkzx_id) saleName,
		        (select t.name from base_employee t,xh_xydkzx xy where t.id=xy.employee_crm and xy.id=a.xydkzx_id) teamName,
		        a.SUB_STATE,
		        (select t.KHMC from XH_XYDKZX t where t.ID=a.XYDKZX_ID) KHMC,
		        a.province,
		         (
		         select name from base_city z
		         where z.id=a.province
		         ) as proname,
		         a.city,
		         (
		         select name from base_city z
		         where z.id=a.city
		         ) as cityname,
		         a.area,
		         (
		         select name from base_city z
		         where z.id=a.area
		         ) as areaname
		                  
		        
		       from XH_JKSQ a
		        , XH_XYDKZX b, xh_jkht h
		        where 1=1
		        and a.XYDKZX_ID=b.ID 
		        and h.jksq_id = a.id
		        $sql
		     ) z
		    where 1=1 and isExpire <= 0 and dqrq <= to_char(sysdate,'yyyy-mm-dd')
			$sql1
			]]></sqlString>
	</sql>
	
				<!-- 
				decode(a.JK_TYPE,'A','老板贷','B','老板楼易贷','C','薪水贷','D','薪水楼易贷','E','精英贷') JK_TYPE_INFO,
				(select t.together_name from xh_jksq_together t where t.xhjksq_id=a.ID) TOGETHER_PERSON,
				
				a.ID作为查询条件就报错
				(select together_name from (
					select t.together_name from xh_jksq_together t where t.xhjksq_id=a.ID 
					order by to_number(t.id) desc
					) where rownum=1 ) TOGETHER_PERSON,
				
				a.TOGETHER_PERSON, 
				
				(select SALE_NAME from XH_XYDKZX t where t.ID=a.XYDKZX_ID) saleName,
				(select TEAM_NAME from XH_XYDKZX t where t.ID=a.XYDKZX_ID) teamName,
				
				(select t.name from base_employee t,xh_xydkzx xy 
		        where t.id=xy.employee_crm and xy.id=a.id) employee_crm,
		        (select t.name from base_employee t,xh_xydkzx xy 
		        where t.id=xy.employee_cca and xy.id=a.id) employee_cca,
				-->
	<!-- 		
				a.EMPLOYEE_CRM,
				(
				  select name from BASE_EMPLOYEE z
				  where z.id = a.EMPLOYEE_CRM
				)as EMPLOYEE_CRM_name,
				a.EMPLOYEE_CCA,
				(
				  select name from BASE_EMPLOYEE z
				  where z.id = a.EMPLOYEE_CCA
				)as EMPLOYEE_CCA_name, 
				
				decode(a.STATE,'0','正在填写借款申请','01','待填写共同借款人信息','02','待上传授信资料','03','待信审',
				    '30','信审任务分派中','31','待信用初审','32','待信用复审','33','待信用终审',
				    '34','信审初审拒绝','35','信审复审拒绝','36','信审终审拒绝',
				    '50','待合同制作','51','待合同审核','52','合同制作审核拒绝',
				    '55','待签约','56','签订合同上传待审核','57','合同签订上传审核拒绝',
				    '60','待放款','65','已放款','80','超时冻结','81','客户放弃','82','拒贷',
				    '90','已完成') stateInfo,-->
	
	<sql name="getTaskByStateAndEmployee" common="true">
		<sqlString><![CDATA[
		select * from (
							select 
				a.ID,a.JKRXM,a.JK_LOAN_QUOTA,a.JK_CYCLE,
				to_char(a.JK_LOAN_DATE,'yyyy-mm-dd') as JK_LOAN_DATE,a.JK_USE,
				a.TOGETHER_PERSON istogether,
				
				(select k.together_name from xh_jksq_together k 
					where k.id =(
						select max(t.id) from xh_jksq_together t 
						where t.xhjksq_id=a.id 
				) ) as TOGETHER_PERSON,
				
				a.BANK_OPEN,a.BANK_USERNAME,a.BANK_NUM,
				a.JK_TYPE,
				(select t.description from base_attr t where t.value=a.JK_TYPE and t.type_id='3') JK_TYPE_INFO,
				a.EXAM_STATE,a.EXAM_END_STATE,
				a.CREATE_BY,	to_char(a.create_time,'yyyy-mm-dd HH24:MI:SS') as createTime,a.LAST_MODIFY_BY,
				to_char(a.LAST_MODIFY_TIME,'yyyy-mm-dd HH24:MI:SS') as lastModifyTime,
				a.ORGANI_ID,a.ANNUAL_INCOME,a.BIRTHDAY,a.COMPANY,a.COMPANY_ADRESS,
				a.COMPANY_NATURE,a.COMPANY_PHONE,a.DATA,a.EMAIL,
				a.ENGLISH_NAME,a.GENDERS,a.HJADRESS,a.HOME_ADDRESS,a.HOME_PHONE,
				a.INCOME_ILLUSTRATION,a.LIVE_MESSAGE,a.LIVE_STATE,
				a.MARITAL_STATUS,a.POCERTIFICATES,a.QQHM,a.SPOUSE_ADRESS,
				a.SPOUSE_ANNUAL_INCOME,a.SPOUSE_BIRTHDAY,a.SPOUSE_COMPANY,
				a.SPOUSE_COMPANY_ADRESS,a.SPOUSE_COMPANY_PHONE,a.SPOUSE_DEP_FUNCTION,
				a.SPOUSE_GENDERS,a.SPOUSE_HOME_PHONE,a.SPOUSE_NAME,a.SPOUSE_POCERTIFICATES,
				a.SPOUSE_TELEPHONE,a.SPOUSE_WORKINGLIFE,a.SPOUSE_ZJHM,a.TELEPHONE,
				a.YWZN,a.ZJHM,a.TEMPLET_ID,
				a.STATE,a.BACKUP01,
				substr(a.BACKUP02,0,19) as BACKUP02,
				a.BACKUP03,a.BACKUP04,
				a.BACKUP05,a.BACKUP06,a.BACKUP07,a.BACKUP08,a.BACKUP09,
				(select KEY_NAME from BASE_ATTR t, BASE_ATTR_TYPE bat 
				    where bat.id = t.type_id and bat.coding = 'JKSQ_STATE' and t.VALUE=a.STATE ) stateInfo,
				a.TXDZ,a.LOAN_CODE,
				a.XYDKZX_ID,a.FKJE,a.APP_STATE,
				(select ID from XH_JKHT t where t.JKSQ_ID=a.ID) XHJKHT_ID,
				(
			        select x.RGANI_NAME from BASE_ZZJG x where x.id =( select y.PARENT_ID from BASE_ZZJG y
			         where y.id =(select ORGANI_ID from BASE_EMPLOYEE z
			       where z.id = (select t.employee_crm from XH_XYDKZX t where t.ID=a.XYDKZX_ID)))
			     ) as yyb,
			     (
			        select x.id from BASE_ZZJG x where x.id =( select y.PARENT_ID from BASE_ZZJG y
			         where y.id =(select ORGANI_ID from BASE_EMPLOYEE z
			       where z.id = (select t.employee_crm from XH_XYDKZX t where t.ID=a.XYDKZX_ID)))
			     ) as yybid,
				(select t.name from base_employee t,xh_xydkzx xy where t.id=xy.employee_cca and xy.id=a.xydkzx_id) saleName,
				(select t.name from base_employee t,xh_xydkzx xy where t.id=xy.employee_crm and xy.id=a.xydkzx_id) teamName,
				a.SUB_STATE,
				(select t.KHMC from XH_XYDKZX t where t.ID=a.XYDKZX_ID) KHMC,
				a.province,
				 a.city,
				 a.area
			  from XH_JKSQ a,
			      XH_CREDIT_TASK_ASSIGN TASKASSIGN
			  $tablesql
			      WHERE 1=1
			      AND  TASKASSIGN.LOAN_APPLY_ID = a.id
			  $unionsql
			  $sql
			 ) z
		where 1=1 
		$sql2
			]]></sqlString>
	</sql>
			
	<!-- 查询 总数 -->
	<sql name="cnt_getTaskByStateAndEmployee" common="false">
		<sqlString>
			<![CDATA[
			SELECT COUNT(*) RecordCount FROM (
			$ibpm_getTaskByStateAndEmployee
			) a
		]]>
		</sqlString>
	</sql>
	<!-- 查询 列表分页 -->
	<sql name="page_getTaskByStateAndEmployee" common="false">
		<sqlString>
			<![CDATA[
			$ibpm_queryPageBefore
			$ibpm_getTaskByStateAndEmployee
			$ibpm_queryPageAfter
			]]>
		</sqlString>
	</sql>
	<!-- 查询 总数 -->
	<sql name="cnt_queryJksqExpireList" common="false">
		<sqlString>
			<![CDATA[
			SELECT COUNT(*) RecordCount FROM (
			$ibpm_queryJksqExpireList
			) a
		]]>
		</sqlString>
	</sql>
	<!-- 查询 列表分页 -->
	<sql name="page_queryJksqExpireList" common="false">
		<sqlString>
			<![CDATA[
			$ibpm_queryPageBefore
			$ibpm_queryJksqExpireList
			$ibpm_queryPageAfter
			]]>
		</sqlString>
	</sql>
	
	
	
	
	
	<!-- 借款申请进件统计报表查询 -->
	<sql name="queryJksqJinJianList" common="true">
		<sqlString><![CDATA[
		    select xx.*--,JKSQ_REGISTER_UTIL.alltimes(to_char(xx.MAKE_LOAN_DATE,'yyyy-MM-dd'),xx.uploadtime) as alltimes
 ,JKSQ_REGISTER_UTIL.rebacktime(MAKE_LOAN_DATE) as MAKELOANDATE  
 ,(
                select x.RGANI_NAME from BASE_ZZJG x where x.id = xx.yybid
             ) as yyb
        from (
        select a.id,
        a.jkrxm,
        (select t.description from base_attr t where t.value=a.JK_TYPE and t.type_id='3') JK_TYPE_INFO,
        a.JK_LOAN_QUOTA,
        JK_CYCLE,
        (select t.name from base_employee t,xh_xydkzx xy where t.id=xy.employee_cca and xy.id=a.xydkzx_id) saleName,
        (select t.name from base_employee t,xh_xydkzx xy where t.id=xy.employee_crm and xy.id=a.xydkzx_id) teamName,
        JKSQ_REGISTER_UTIL.rebacktime(a.JK_LOAN_DATE) as JK_LOAN_DATE
         ,a.create_by
         ,(select z.emp_no  from xh_credit_task_assign t,BASE_EMPLOYEE z where z.id=t.first_audit_employee_id and t.loan_apply_id=a.id) as chushen_person
        --,JKSQ_REGISTER_UTIL.backtime(a.id,'上传授信资料成功','') as uploadtime
        --,JKSQ_REGISTER_UTIL.backtime(a.id,'','31.A') as waifangtime
        --,JKSQ_REGISTER_UTIL.backtime(a.id,'上传外访资料成功','') as uploadwaifangtime
        --,JKSQ_REGISTER_UTIL.isBackRegister(a.id,'信用初审退回!') as isBackRegister
        --,JKSQ_REGISTER_UTIL.resetRegisterTime(a.id,'信用初审退回!') as resetRegisterTime
        ,(select z.key_name from base_attr z where z.value=a.state and z.type_id='1') as state
        --,JKSQ_REGISTER_UTIL.refuseCause(a.id) as refuseCause
        ,a.FKJE
        ,b.HKQS as HKQS
        --,JKSQ_REGISTER_UTIL.overcredittime(a.id) as overcredittime
        --,JKSQ_REGISTER_UTIL.backtime(a.id,'','51') as makeJkhttime
        ,JKSQ_REGISTER_UTIL.rebacktime(to_date(b.QDRQ,'yyyy-MM-dd')) as QDRQ
        ,(select z.MAKE_LOAN_DATE from xh_make_loans z where z.LOAN_CONTRACT_ID = b.id) as MAKE_LOAN_DATE
        --,JKSQ_REGISTER_UTIL.giveupcause(a.id,'81') as giveupcause
             ,(
                select x.id from BASE_ZZJG x where x.id =( select y.PARENT_ID from BASE_ZZJG y
                 where y.id =(select ORGANI_ID from BASE_EMPLOYEE z
               where z.id = (select t.employee_cca from XH_XYDKZX t where t.ID=a.XYDKZX_ID)))
             ) as yybid
        from xh_jksq a,xh_jkht b
        where 1=1 
        and b.jksq_id = a.id
        and a.JK_LOAN_DATE>to_date('2013-06-01','yyyy-MM-dd') 
        --and a.jkrxm='张海红'
        $sql
        --order by a.JK_LOAN_DATE
      ) xx where 1=1 $sql1
      order by yybid asc,JK_LOAN_DATE asc
			]]></sqlString>
	</sql>
	
	<!-- 查询 总数 -->
	<sql name="cnt_queryJksqJinJianList" common="false">
		<sqlString>
			<![CDATA[
			SELECT COUNT(*) RecordCount FROM (
			$ibpm_queryJksqJinJianList
			) a
		]]>
		</sqlString>
	</sql>
	<!-- 查询 列表分页 -->
	<sql name="page_queryJksqJinJianList" common="false">
		<sqlString>
			<![CDATA[
			$ibpm_queryPageBefore
			$ibpm_queryJksqJinJianList
			$ibpm_queryPageAfter
			]]>
		</sqlString>
	</sql>
</sqlmaps>