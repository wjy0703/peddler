<?xml version="1.0" encoding="UTF-8"?>
<sqlmaps>
	<!-- 出借人 -->
	<sql name="queryCjrxxList" common="true">
		<sqlString><![CDATA[
		select * from
		(
			select 
				a.khly,a.id,a.cjrxm,a.gxcs,a.khbm,a.zt_Flag as ztFlag,a.state,a.upstate,
				a.cjryx,to_char(a.create_time,'yyyy-mm-dd HH24:mi:ss') as createTime,a.cjr_State as CJRSTATE,
				a.create_by,a.organi_id,a.zjhm,
				a.wjbh,
				a.tzfkkhh,a.tzfkyhmc,a.tzfkkhmc,a.tzfkyhzh,a.crmtd,a.kftd,
				a.hszjkhh,a.hszjyhmc,a.hszjkhmc,a.hszjyhzh,
				a.EMPLOYEE_CRM,
				(
				  select name from BASE_EMPLOYEE z
				  where z.id = a.EMPLOYEE_CRM
				)as EMPLOYEE_CRM_name,
				
				
				(
		           select x.RGANI_NAME from BASE_ZZJG x where x.id =( select y.PARENT_ID from BASE_ZZJG y
		            where y.id =(select ORGANI_ID from BASE_EMPLOYEE z
		          where z.id = a.EMPLOYEE_CRM))
		        ) as yyb,
				( select y.PARENT_ID from BASE_ZZJG y
	                where y.id =(select ORGANI_ID from BASE_EMPLOYEE z
	              	where z.id = a.EMPLOYEE_CRM)
	            ) as yybid,
				
				a.EMPLOYEE_CCA,
				(
				  select name from BASE_EMPLOYEE z
				  where z.id = a.EMPLOYEE_CCA
				)as EMPLOYEE_CCA_name,
				a.province,
				 (
				 select name from base_city z
				 where z.id=a.province
				 ) as proname,
				 a.city,
				 (
				 select name from base_city z
				 where z.id=a.city
				 ) as cityname,
				 a.area,
				 (
				 select name from base_city z
				 where z.id=a.area
				 ) as areaname,
				 a.crmprovince,
				 (
				 select name from base_city z
				 where z.id=a.crmprovince
				 ) as crmprovincename,
				 a.crmcity,
				 (
				 select name from base_city z
				 where z.id=a.crmcity
				 ) as crmcityname
			 from XH_CJRXX a
			      where 1=1
			 $sql
			 ) where 1=1 
			 $sql2
			]]></sqlString>
	</sql>
	<!-- 查询 总数 -->
	<sql name="cnt_queryCjrxxList" common="false">
		<sqlString>
			<![CDATA[
			SELECT COUNT(*) RecordCount FROM (
			$ibpm_queryCjrxxList
			)a
		]]>
		</sqlString>
	</sql>
	<!-- 查询 列表分页 -->
	<sql name="page_queryCjrxxList" common="false">
		<sqlString>
			<![CDATA[
			$ibpm_queryPageBefore
			$ibpm_queryCjrxxList
			$ibpm_queryPageAfter
			]]>
		</sqlString>
	</sql>
	
	<!-- 查询营业厅列表 -->
	 <sql name="queryYybList" common="true">
		<sqlString><![CDATA[
		    /*
			select * from (
				select 
		            (
		               select x.RGANI_NAME from BASE_ZZJG x where x.id =( select y.PARENT_ID from BASE_ZZJG y
		                where y.id =(select ORGANI_ID from BASE_EMPLOYEE z
		              where z.id = a.EMPLOYEE_CRM))
		            ) as yyb,
		        	( select y.PARENT_ID from BASE_ZZJG y
		                where y.id =(select ORGANI_ID from BASE_EMPLOYEE z
		              where z.id = a.EMPLOYEE_CRM)
		            ) as yybid  
	       		from XH_CJRXX a
       			where 1=1
				$sql
       		)
	       where yybid is not null
	       and yyb is not null
	       group by yyb,yybid
	       order by yyb desc
	       */
	       
	       select xx.PARENT_ID as yybid,
                  (select zzjg.rgani_name from base_zzjg zzjg where zzjg.id = xx.PARENT_ID) as yyb      from (
				select 
		           (select PARENT_ID from base_zzjg t where t.id = b.organi_id) as  PARENT_ID    
             from XH_CJRXX a,BASE_EMPLOYEE b
             where 1=1
             and a.EMPLOYEE_CRM = b.id
             $sql
           ) xx
         where xx.PARENT_ID != 0
         group by xx.PARENT_ID
         order by xx.PARENT_ID 
			]]></sqlString>
	</sql>
	
</sqlmaps>